<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="navbar.css">
  <link rel="stylesheet" href="general.css">
  <link rel="stylesheet" href="make-a-quiz.css">
</head>
<body>
  <ul class="topnav">
    <li><a class="active" href="index.html">Home</a></li>
    <li><a href="add-question.html">Add questions</a></li>
    <li><a href="make-a-quiz.html">Create a quiz</a></li>
    <li><a href="take-a-quiz.html">Take a quiz</a></li>
    <li class="right"><a href="#about">About</a></li>
  </ul>

  <div class="quiz">
    <h><b>The New Quiz(0 Questions)</b></h>
  <br>
  <br>
  <label for="quizTitle">Quiz Title:</label>
  <input type="text" id="quizTitle" name="quizTitle"><br><br>
  <input type="button" value="Save your changes" onclick="saveQuiz()" />
  <br>
  <br>
  <input type="button" value="Save this quiz and start a new one" onclick="saveQuizandStartNew()" />
  <br>
  <br>
  <p style="font-size:14px; "><b>If you want to remove a question from the quiz, you can click on the question here and it will be removed from the quiz</b></p>
  </div>

  <div class="questions">
    <h1>Test</h1>
    <p><b>Click on a question to add it to the quiz.</b></p>
  </div>


  <script>
    let host = "http://localhost:8080";
    let numQuestions = 0; 
    let selectedQuestions = []; 
    
    function addQuestionToQuiz(questionId) {
      numQuestions++;
      selectedQuestions.push(questionId);
      updateQuizInfo();
    }

    function removeQuestionFromQuiz(questionId) {
      numQuestions--;
      const index = selectedQuestions.indexOf(questionId);
      if (index !== -1) {
        selectedQuestions.splice(index, 1);
      }
      updateQuizInfo();
    }

    function updateQuizInfo() {
      const quizInfo = document.getElementById('quizInfo');
      quizInfo.textContent = `The New Quiz(${numQuestions} Questions)`;
    }

    async function saveQuiz() {
      const quizTitle = document.getElementById('quizTitle').value;
      const quizData = {
        title: quizTitle,
        questionIds: selectedQuestions,
      };
      try {
        let method = 'POST';
        const existingQuizId = localStorage.getItem('quizId');
        if (existingQuizId) {
          method = 'PUT';
          quizData.id = parseInt(existingQuizId);
        }
        
        const response = await fetch(host + '/quizzes', {
          method: method,
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(quizData),
        });

        if (response.ok) {
          const responseData = await response.json();
          localStorage.setItem('quizId', responseData.id);
          alert('Quiz saved successfully!');
        } else {
          alert('Failed to save quiz.');
        }
      } catch (error) {
        console.error('Error saving quiz:', error);
        alert('An error occurred while saving the quiz.');
      }
    }

    async function saveQuizandStartNew() {
      await saveQuiz(); 
      location.reload(); 
    }


  </script>
</body>
</html>